{"ast":null,"code":"\"use strict\";\n\n/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\nrequire(\"core-js/modules/es.array.push.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.BaseTransaction = void 0;\nconst web3_utils_1 = require(\"web3-utils\");\nconst constants_js_1 = require(\"./constants.js\");\nconst utils_js_1 = require(\"../common/utils.js\");\nconst common_js_1 = require(\"../common/common.js\");\nconst enums_js_1 = require(\"../common/enums.js\");\nconst types_js_1 = require(\"./types.js\");\nconst address_js_1 = require(\"./address.js\");\nconst utils_js_2 = require(\"./utils.js\");\n/**\n * This base class will likely be subject to further\n * refactoring along the introduction of additional tx types\n * on the Ethereum network.\n *\n * It is therefore not recommended to use directly.\n */\nclass BaseTransaction {\n  constructor(txData, opts) {\n    var _a, _b;\n    this.cache = {\n      hash: undefined,\n      dataFee: undefined\n    };\n    /**\n     * List of tx type defining EIPs,\n     * e.g. 1559 (fee market) and 2930 (access lists)\n     * for FeeMarketEIP1559Transaction objects\n     */\n    this.activeCapabilities = [];\n    /**\n     * The default chain the tx falls back to if no Common\n     * is provided and if the chain can't be derived from\n     * a passed in chainId (only EIP-2718 typed txs) or\n     * EIP-155 signature (legacy txs).\n     *\n     * @hidden\n     */\n    this.DEFAULT_CHAIN = enums_js_1.Chain.Mainnet;\n    /**\n     * The default HF if the tx type is active on that HF\n     * or the first greater HF where the tx is active.\n     *\n     * @hidden\n     */\n    this.DEFAULT_HARDFORK = enums_js_1.Hardfork.Merge;\n    const {\n      nonce,\n      gasLimit,\n      to,\n      value,\n      data,\n      v,\n      r,\n      s,\n      type\n    } = txData;\n    this._type = Number((0, utils_js_1.uint8ArrayToBigInt)((0, utils_js_1.toUint8Array)(type)));\n    this.txOptions = opts;\n    const toB = (0, utils_js_1.toUint8Array)(to === '' ? '0x' : to);\n    const vB = (0, utils_js_1.toUint8Array)(v === '' ? '0x' : v);\n    const rB = (0, utils_js_1.toUint8Array)(r === '' ? '0x' : r);\n    const sB = (0, utils_js_1.toUint8Array)(s === '' ? '0x' : s);\n    this.nonce = (0, utils_js_1.uint8ArrayToBigInt)((0, utils_js_1.toUint8Array)(nonce === '' ? '0x' : nonce));\n    this.gasLimit = (0, utils_js_1.uint8ArrayToBigInt)((0, utils_js_1.toUint8Array)(gasLimit === '' ? '0x' : gasLimit));\n    this.to = toB.length > 0 ? new address_js_1.Address(toB) : undefined;\n    this.value = (0, utils_js_1.uint8ArrayToBigInt)((0, utils_js_1.toUint8Array)(value === '' ? '0x' : value));\n    this.data = (0, utils_js_1.toUint8Array)(data === '' ? '0x' : data);\n    this.v = vB.length > 0 ? (0, utils_js_1.uint8ArrayToBigInt)(vB) : undefined;\n    this.r = rB.length > 0 ? (0, utils_js_1.uint8ArrayToBigInt)(rB) : undefined;\n    this.s = sB.length > 0 ? (0, utils_js_1.uint8ArrayToBigInt)(sB) : undefined;\n    this._validateCannotExceedMaxInteger({\n      value: this.value,\n      r: this.r,\n      s: this.s\n    });\n    // geth limits gasLimit to 2^64-1\n    this._validateCannotExceedMaxInteger({\n      gasLimit: this.gasLimit\n    }, 64);\n    // EIP-2681 limits nonce to 2^64-1 (cannot equal 2^64-1)\n    this._validateCannotExceedMaxInteger({\n      nonce: this.nonce\n    }, 64, true);\n    // eslint-disable-next-line no-null/no-null\n    const createContract = this.to === undefined || this.to === null;\n    const allowUnlimitedInitCodeSize = (_a = opts.allowUnlimitedInitCodeSize) !== null && _a !== void 0 ? _a : false;\n    const common = (_b = opts.common) !== null && _b !== void 0 ? _b : this._getCommon();\n    if (createContract && common.isActivatedEIP(3860) && !allowUnlimitedInitCodeSize) {\n      (0, utils_js_2.checkMaxInitCodeSize)(common, this.data.length);\n    }\n  }\n  /**\n   * Returns the transaction type.\n   *\n   * Note: legacy txs will return tx type `0`.\n   */\n  get type() {\n    return this._type;\n  }\n  /**\n   * Checks if a tx type defining capability is active\n   * on a tx, for example the EIP-1559 fee market mechanism\n   * or the EIP-2930 access list feature.\n   *\n   * Note that this is different from the tx type itself,\n   * so EIP-2930 access lists can very well be active\n   * on an EIP-1559 tx for example.\n   *\n   * This method can be useful for feature checks if the\n   * tx type is unknown (e.g. when instantiated with\n   * the tx factory).\n   *\n   * See `Capabilites` in the `types` module for a reference\n   * on all supported capabilities.\n   */\n  supports(capability) {\n    return this.activeCapabilities.includes(capability);\n  }\n  validate(stringError = false) {\n    const errors = [];\n    if (this.getBaseFee() > this.gasLimit) {\n      errors.push(`gasLimit is too low. given ${this.gasLimit}, need at least ${this.getBaseFee()}`);\n    }\n    if (this.isSigned() && !this.verifySignature()) {\n      errors.push('Invalid Signature');\n    }\n    return stringError ? errors : errors.length === 0;\n  }\n  _validateYParity() {\n    const {\n      v\n    } = this;\n    if (v !== undefined && v !== BigInt(0) && v !== BigInt(1)) {\n      const msg = this._errorMsg('The y-parity of the transaction should either be 0 or 1');\n      throw new Error(msg);\n    }\n  }\n  /**\n   * EIP-2: All transaction signatures whose s-value is greater than secp256k1n/2are considered invalid.\n   * Reasoning: https://ethereum.stackexchange.com/a/55728\n   */\n  _validateHighS() {\n    const {\n      s\n    } = this;\n    if (this.common.gteHardfork('homestead') && s !== undefined && s > constants_js_1.SECP256K1_ORDER_DIV_2) {\n      const msg = this._errorMsg('Invalid Signature: s-values greater than secp256k1n/2 are considered invalid');\n      throw new Error(msg);\n    }\n  }\n  /**\n   * The minimum amount of gas the tx must have (DataFee + TxFee + Creation Fee)\n   */\n  getBaseFee() {\n    const txFee = this.common.param('gasPrices', 'tx');\n    let fee = this.getDataFee();\n    if (txFee) fee += txFee;\n    if (this.common.gteHardfork('homestead') && this.toCreationAddress()) {\n      const txCreationFee = this.common.param('gasPrices', 'txCreation');\n      if (txCreationFee) fee += txCreationFee;\n    }\n    return fee;\n  }\n  /**\n   * The amount of gas paid for the data in this tx\n   */\n  getDataFee() {\n    const txDataZero = this.common.param('gasPrices', 'txDataZero');\n    const txDataNonZero = this.common.param('gasPrices', 'txDataNonZero');\n    let cost = BigInt(0);\n    // eslint-disable-next-line @typescript-eslint/prefer-for-of\n    for (let i = 0; i < this.data.length; i += 1) {\n      // eslint-disable-next-line @typescript-eslint/no-unused-expressions, no-unused-expressions\n      this.data[i] === 0 ? cost += txDataZero : cost += txDataNonZero;\n    }\n    // eslint-disable-next-line no-null/no-null\n    if ((this.to === undefined || this.to === null) && this.common.isActivatedEIP(3860)) {\n      const dataLength = BigInt(Math.ceil(this.data.length / 32));\n      const initCodeCost = this.common.param('gasPrices', 'initCodeWordCost') * dataLength;\n      cost += initCodeCost;\n    }\n    return cost;\n  }\n  /**\n   * If the tx's `to` is to the creation address\n   */\n  toCreationAddress() {\n    return this.to === undefined || this.to.buf.length === 0;\n  }\n  isSigned() {\n    const {\n      v,\n      r,\n      s\n    } = this;\n    if (v === undefined || r === undefined || s === undefined) {\n      return false;\n    }\n    return true;\n  }\n  /**\n   * Determines if the signature is valid\n   */\n  verifySignature() {\n    try {\n      // Main signature verification is done in `getSenderPublicKey()`\n      const publicKey = this.getSenderPublicKey();\n      return (0, utils_js_1.unpadUint8Array)(publicKey).length !== 0;\n    } catch (e) {\n      return false;\n    }\n  }\n  /**\n   * Returns the sender's address\n   */\n  getSenderAddress() {\n    return new address_js_1.Address(address_js_1.Address.publicToAddress(this.getSenderPublicKey()));\n  }\n  /**\n   * Signs a transaction.\n   *\n   * Note that the signed tx is returned as a new object,\n   * use as follows:\n   * ```javascript\n   * const signedTx = tx.sign(privateKey)\n   * ```\n   */\n  sign(privateKey) {\n    if (privateKey.length !== 32) {\n      const msg = this._errorMsg('Private key must be 32 bytes in length.');\n      throw new Error(msg);\n    }\n    // Hack for the constellation that we have got a legacy tx after spuriousDragon with a non-EIP155 conforming signature\n    // and want to recreate a signature (where EIP155 should be applied)\n    // Leaving this hack lets the legacy.spec.ts -> sign(), verifySignature() test fail\n    // 2021-06-23\n    let hackApplied = false;\n    if (this.type === 0 && this.common.gteHardfork('spuriousDragon') && !this.supports(types_js_1.Capability.EIP155ReplayProtection)) {\n      this.activeCapabilities.push(types_js_1.Capability.EIP155ReplayProtection);\n      hackApplied = true;\n    }\n    const msgHash = this.getMessageToSign(true);\n    const {\n      v,\n      r,\n      s\n    } = this._ecsign(msgHash, privateKey);\n    const tx = this._processSignature(v, r, s);\n    // Hack part 2\n    if (hackApplied) {\n      const index = this.activeCapabilities.indexOf(types_js_1.Capability.EIP155ReplayProtection);\n      if (index > -1) {\n        this.activeCapabilities.splice(index, 1);\n      }\n    }\n    return tx;\n  }\n  /**\n   * Does chain ID checks on common and returns a common\n   * to be used on instantiation\n   * @hidden\n   *\n   * @param common - {@link Common} instance from tx options\n   * @param chainId - Chain ID from tx options (typed txs) or signature (legacy tx)\n   */\n  _getCommon(common, chainId) {\n    var _a;\n    // Chain ID provided\n    if (chainId !== undefined) {\n      const chainIdBigInt = (0, utils_js_1.uint8ArrayToBigInt)((0, utils_js_1.toUint8Array)(chainId));\n      if (common) {\n        if (common.chainId() !== chainIdBigInt) {\n          const msg = this._errorMsg('The chain ID does not match the chain ID of Common');\n          throw new Error(msg);\n        }\n        // Common provided, chain ID does match\n        // -> Return provided Common\n        return common.copy();\n      }\n      if (common_js_1.Common.isSupportedChainId(chainIdBigInt)) {\n        // No Common, chain ID supported by Common\n        // -> Instantiate Common with chain ID\n        return new common_js_1.Common({\n          chain: chainIdBigInt,\n          hardfork: this.DEFAULT_HARDFORK\n        });\n      }\n      // No Common, chain ID not supported by Common\n      // -> Instantiate custom Common derived from DEFAULT_CHAIN\n      return common_js_1.Common.custom({\n        name: 'custom-chain',\n        networkId: chainIdBigInt,\n        chainId: chainIdBigInt\n      }, {\n        baseChain: this.DEFAULT_CHAIN,\n        hardfork: this.DEFAULT_HARDFORK\n      });\n    }\n    // No chain ID provided\n    // -> return Common provided or create new default Common\n    return (_a = common === null || common === void 0 ? void 0 : common.copy()) !== null && _a !== void 0 ? _a : new common_js_1.Common({\n      chain: this.DEFAULT_CHAIN,\n      hardfork: this.DEFAULT_HARDFORK\n    });\n  }\n  /**\n   * Validates that an object with BigInt values cannot exceed the specified bit limit.\n   * @param values Object containing string keys and BigInt values\n   * @param bits Number of bits to check (64 or 256)\n   * @param cannotEqual Pass true if the number also cannot equal one less the maximum value\n   */\n  _validateCannotExceedMaxInteger(values, bits = 256, cannotEqual = false) {\n    for (const [key, value] of Object.entries(values)) {\n      switch (bits) {\n        case 64:\n          if (cannotEqual) {\n            if (value !== undefined && value >= constants_js_1.MAX_UINT64) {\n              const msg = this._errorMsg(`${key} cannot equal or exceed MAX_UINT64 (2^64-1), given ${value}`);\n              throw new Error(msg);\n            }\n          } else if (value !== undefined && value > constants_js_1.MAX_UINT64) {\n            const msg = this._errorMsg(`${key} cannot exceed MAX_UINT64 (2^64-1), given ${value}`);\n            throw new Error(msg);\n          }\n          break;\n        case 256:\n          if (cannotEqual) {\n            if (value !== undefined && value >= constants_js_1.MAX_INTEGER) {\n              const msg = this._errorMsg(`${key} cannot equal or exceed MAX_INTEGER (2^256-1), given ${value}`);\n              throw new Error(msg);\n            }\n          } else if (value !== undefined && value > constants_js_1.MAX_INTEGER) {\n            const msg = this._errorMsg(`${key} cannot exceed MAX_INTEGER (2^256-1), given ${value}`);\n            throw new Error(msg);\n          }\n          break;\n        default:\n          {\n            const msg = this._errorMsg('unimplemented bits value');\n            throw new Error(msg);\n          }\n      }\n    }\n  }\n  static _validateNotArray(values) {\n    const txDataKeys = ['nonce', 'gasPrice', 'gasLimit', 'to', 'value', 'data', 'v', 'r', 's', 'type', 'baseFee', 'maxFeePerGas', 'chainId'];\n    for (const [key, value] of Object.entries(values)) {\n      if (txDataKeys.includes(key)) {\n        if (Array.isArray(value)) {\n          throw new Error(`${key} cannot be an array`);\n        }\n      }\n    }\n  }\n  /**\n   * Returns the shared error postfix part for _error() method\n   * tx type implementations.\n   */\n  _getSharedErrorPostfix() {\n    let hash = '';\n    try {\n      hash = this.isSigned() ? (0, web3_utils_1.bytesToHex)(this.hash()) : 'not available (unsigned)';\n    } catch (e) {\n      hash = 'error';\n    }\n    let isSigned = '';\n    try {\n      isSigned = this.isSigned().toString();\n    } catch (e) {\n      hash = 'error';\n    }\n    let hf = '';\n    try {\n      hf = this.common.hardfork();\n    } catch (e) {\n      hf = 'error';\n    }\n    let postfix = `tx type=${this.type} hash=${hash} nonce=${this.nonce} value=${this.value} `;\n    postfix += `signed=${isSigned} hf=${hf}`;\n    return postfix;\n  }\n  // eslint-disable-next-line class-methods-use-this\n  _ecsign(msgHash, privateKey, chainId) {\n    const signature = constants_js_1.secp256k1.sign(msgHash, privateKey);\n    const signatureBytes = signature.toCompactRawBytes();\n    const r = signatureBytes.subarray(0, 32);\n    const s = signatureBytes.subarray(32, 64);\n    const v = chainId === undefined ? BigInt(signature.recovery + 27) : BigInt(signature.recovery + 35) + BigInt(chainId) * BigInt(2);\n    return {\n      r,\n      s,\n      v\n    };\n  }\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  static fromSerializedTx(\n  // @ts-expect-error unused variable\n  serialized,\n  // @ts-expect-error unused variable\n  opts = {}) {}\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  static fromTxData(\n  // @ts-expect-error unused variable\n  txData,\n  // @ts-expect-error unused variable\n  opts = {}) {}\n}\nexports.BaseTransaction = BaseTransaction;","map":{"version":3,"names":["require","web3_utils_1","constants_js_1","utils_js_1","common_js_1","enums_js_1","types_js_1","address_js_1","utils_js_2","BaseTransaction","constructor","txData","opts","cache","hash","undefined","dataFee","activeCapabilities","DEFAULT_CHAIN","Chain","Mainnet","DEFAULT_HARDFORK","Hardfork","Merge","nonce","gasLimit","to","value","data","v","r","s","type","_type","Number","uint8ArrayToBigInt","toUint8Array","txOptions","toB","vB","rB","sB","length","Address","_validateCannotExceedMaxInteger","createContract","allowUnlimitedInitCodeSize","_a","common","_b","_getCommon","isActivatedEIP","checkMaxInitCodeSize","supports","capability","includes","validate","stringError","errors","getBaseFee","push","isSigned","verifySignature","_validateYParity","BigInt","msg","_errorMsg","Error","_validateHighS","gteHardfork","SECP256K1_ORDER_DIV_2","txFee","param","fee","getDataFee","toCreationAddress","txCreationFee","txDataZero","txDataNonZero","cost","i","dataLength","Math","ceil","initCodeCost","buf","publicKey","getSenderPublicKey","unpadUint8Array","e","getSenderAddress","publicToAddress","sign","privateKey","hackApplied","Capability","EIP155ReplayProtection","msgHash","getMessageToSign","_ecsign","tx","_processSignature","index","indexOf","splice","chainId","chainIdBigInt","copy","Common","isSupportedChainId","chain","hardfork","custom","name","networkId","baseChain","values","bits","cannotEqual","key","Object","entries","MAX_UINT64","MAX_INTEGER","_validateNotArray","txDataKeys","Array","isArray","_getSharedErrorPostfix","bytesToHex","toString","hf","postfix","signature","secp256k1","signatureBytes","toCompactRawBytes","subarray","recovery","fromSerializedTx","serialized","fromTxData","exports"],"sources":["../../../src/tx/baseTransaction.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}