{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/web.immediate.js\");\nvar __createBinding = this && this.__createBinding || (Object.create ? function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  var desc = Object.getOwnPropertyDescriptor(m, k);\n  if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n    desc = {\n      enumerable: true,\n      get: function () {\n        return m[k];\n      }\n    };\n  }\n  Object.defineProperty(o, k2, desc);\n} : function (o, m, k, k2) {\n  if (k2 === undefined) k2 = k;\n  o[k2] = m[k];\n});\nvar __setModuleDefault = this && this.__setModuleDefault || (Object.create ? function (o, v) {\n  Object.defineProperty(o, \"default\", {\n    enumerable: true,\n    value: v\n  });\n} : function (o, v) {\n  o[\"default\"] = v;\n});\nvar __importStar = this && this.__importStar || function (mod) {\n  if (mod && mod.__esModule) return mod;\n  var result = {};\n  if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n  __setModuleDefault(result, mod);\n  return result;\n};\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.SocketProvider = void 0;\nconst web3_errors_1 = require(\"web3-errors\");\nconst web3_eip1193_provider_js_1 = require(\"./web3_eip1193_provider.js\");\nconst chunk_response_parser_js_1 = require(\"./chunk_response_parser.js\");\nconst validation_js_1 = require(\"./validation.js\");\nconst web3_deferred_promise_js_1 = require(\"./web3_deferred_promise.js\");\nconst jsonRpc = __importStar(require(\"./json_rpc.js\"));\nconst DEFAULT_RECONNECTION_OPTIONS = {\n  autoReconnect: true,\n  delay: 5000,\n  maxAttempts: 5\n};\nconst NORMAL_CLOSE_CODE = 1000; // https://developer.mozilla.org/en-US/docs/Web/API/WebSocket/close\nclass SocketProvider extends web3_eip1193_provider_js_1.Eip1193Provider {\n  /**\n   * This is an abstract class for implementing a socket provider (e.g. WebSocket, IPC). It extends the EIP-1193 provider {@link EIP1193Provider}.\n   * @param socketPath - The path to the socket (e.g. /ipc/path or ws://localhost:8546)\n   * @param socketOptions - The options for the socket connection. Its type is supposed to be specified in the inherited classes.\n   * @param reconnectOptions - The options for the socket reconnection {@link ReconnectOptions}\n   */\n  constructor(socketPath, socketOptions, reconnectOptions) {\n    super();\n    this._connectionStatus = 'connecting';\n    // Message handlers. Due to bounding of `this` and removing the listeners we have to keep it's reference.\n    this._onMessageHandler = this._onMessage.bind(this);\n    this._onOpenHandler = this._onConnect.bind(this);\n    this._onCloseHandler = this._onCloseEvent.bind(this);\n    this._onErrorHandler = this._onError.bind(this);\n    if (!this._validateProviderPath(socketPath)) throw new web3_errors_1.InvalidClientError(socketPath);\n    this._socketPath = socketPath;\n    this._socketOptions = socketOptions;\n    this._reconnectOptions = Object.assign(Object.assign({}, DEFAULT_RECONNECTION_OPTIONS), reconnectOptions !== null && reconnectOptions !== void 0 ? reconnectOptions : {});\n    this._pendingRequestsQueue = new Map();\n    this._sentRequestsQueue = new Map();\n    this._init();\n    this.connect();\n    this.chunkResponseParser = new chunk_response_parser_js_1.ChunkResponseParser(this._eventEmitter, this._reconnectOptions.autoReconnect);\n    this.chunkResponseParser.onError(() => {\n      this._clearQueues();\n    });\n    this.isReconnecting = false;\n  }\n  get SocketConnection() {\n    return this._socketConnection;\n  }\n  _init() {\n    this._reconnectAttempts = 0;\n  }\n  /**\n   * Try to establish a connection to the socket\n   */\n  connect() {\n    try {\n      this._openSocketConnection();\n      this._connectionStatus = 'connecting';\n      this._addSocketListeners();\n    } catch (e) {\n      if (!this.isReconnecting) {\n        this._connectionStatus = 'disconnected';\n        if (e && e.message) {\n          throw new web3_errors_1.ConnectionError(`Error while connecting to ${this._socketPath}. Reason: ${e.message}`);\n        } else {\n          throw new web3_errors_1.InvalidClientError(this._socketPath);\n        }\n      } else {\n        setImmediate(() => {\n          this._reconnect();\n        });\n      }\n    }\n  }\n  // eslint-disable-next-line class-methods-use-this\n  _validateProviderPath(path) {\n    return !!path;\n  }\n  /**\n   *\n   * @returns the pendingRequestQueue size\n   */\n  // eslint-disable-next-line class-methods-use-this\n  getPendingRequestQueueSize() {\n    return this._pendingRequestsQueue.size;\n  }\n  /**\n   *\n   * @returns the sendPendingRequests size\n   */\n  // eslint-disable-next-line class-methods-use-this\n  getSentRequestsQueueSize() {\n    return this._sentRequestsQueue.size;\n  }\n  /**\n   *\n   * @returns `true` if the socket supports subscriptions\n   */\n  // eslint-disable-next-line class-methods-use-this\n  supportsSubscriptions() {\n    return true;\n  }\n  on(type, listener) {\n    this._eventEmitter.on(type, listener);\n  }\n  once(type, listener) {\n    this._eventEmitter.once(type, listener);\n  }\n  removeListener(type, listener) {\n    this._eventEmitter.removeListener(type, listener);\n  }\n  _onDisconnect(code, data) {\n    this._connectionStatus = 'disconnected';\n    super._onDisconnect(code, data);\n  }\n  /**\n   * Disconnects the socket\n   * @param code - The code to be sent to the server\n   * @param data - The data to be sent to the server\n   */\n  disconnect(code, data) {\n    const disconnectCode = code !== null && code !== void 0 ? code : NORMAL_CLOSE_CODE;\n    this._removeSocketListeners();\n    if (this.getStatus() !== 'disconnected') {\n      this._closeSocketConnection(disconnectCode, data);\n    }\n    this._onDisconnect(disconnectCode, data);\n  }\n  /**\n   * Safely disconnects the socket, async and waits for request size to be 0 before disconnecting\n   * @param forceDisconnect - If true, will clear queue after 5 attempts of waiting for both pending and sent queue to be 0\n   * @param ms - Determines the ms of setInterval\n   * @param code - The code to be sent to the server\n   * @param data - The data to be sent to the server\n   */\n  safeDisconnect(code, data, forceDisconnect = false, ms = 1000) {\n    return __awaiter(this, void 0, void 0, function* () {\n      let retryAttempt = 0;\n      const checkQueue = () => __awaiter(this, void 0, void 0, function* () {\n        return new Promise(resolve => {\n          const interval = setInterval(() => {\n            if (forceDisconnect && retryAttempt === 5) {\n              this.clearQueues();\n            }\n            if (this.getPendingRequestQueueSize() === 0 && this.getSentRequestsQueueSize() === 0) {\n              clearInterval(interval);\n              resolve(true);\n            }\n            retryAttempt += 1;\n          }, ms);\n        });\n      });\n      yield checkQueue();\n      this.disconnect(code, data);\n    });\n  }\n  /**\n   * Removes all listeners for the specified event type.\n   * @param type - The event type to remove the listeners for\n   */\n  removeAllListeners(type) {\n    this._eventEmitter.removeAllListeners(type);\n  }\n  _onError(event) {\n    // do not emit error while trying to reconnect\n    if (this.isReconnecting) {\n      this._reconnect();\n    } else {\n      this._eventEmitter.emit('error', event);\n    }\n  }\n  /**\n   * Resets the socket, removing all listeners and pending requests\n   */\n  reset() {\n    this._sentRequestsQueue.clear();\n    this._pendingRequestsQueue.clear();\n    this._init();\n    this._removeSocketListeners();\n    this._addSocketListeners();\n  }\n  _reconnect() {\n    if (this.isReconnecting) {\n      return;\n    }\n    this.isReconnecting = true;\n    if (this._sentRequestsQueue.size > 0) {\n      this._sentRequestsQueue.forEach((request, key) => {\n        request.deferredPromise.reject(new web3_errors_1.PendingRequestsOnReconnectingError());\n        this._sentRequestsQueue.delete(key);\n      });\n    }\n    if (this._reconnectAttempts < this._reconnectOptions.maxAttempts) {\n      this._reconnectAttempts += 1;\n      setTimeout(() => {\n        this._removeSocketListeners();\n        this.connect();\n        this.isReconnecting = false;\n      }, this._reconnectOptions.delay);\n    } else {\n      this.isReconnecting = false;\n      this._clearQueues();\n      this._removeSocketListeners();\n      this._eventEmitter.emit('error', new web3_errors_1.MaxAttemptsReachedOnReconnectingError(this._reconnectOptions.maxAttempts));\n    }\n  }\n  /**\n   *  Creates a request object to be sent to the server\n   */\n  request(request) {\n    return __awaiter(this, void 0, void 0, function* () {\n      if ((0, validation_js_1.isNullish)(this._socketConnection)) {\n        throw new Error('Connection is undefined');\n      }\n      // if socket disconnected - open connection\n      if (this.getStatus() === 'disconnected') {\n        this.connect();\n      }\n      const requestId = jsonRpc.isBatchRequest(request) ? request[0].id : request.id;\n      if (!requestId) {\n        throw new web3_errors_1.Web3WSProviderError('Request Id not defined');\n      }\n      if (this._sentRequestsQueue.has(requestId)) {\n        throw new web3_errors_1.RequestAlreadySentError(requestId);\n      }\n      const deferredPromise = new web3_deferred_promise_js_1.Web3DeferredPromise();\n      deferredPromise.catch(error => {\n        this._eventEmitter.emit('error', error);\n      });\n      const reqItem = {\n        payload: request,\n        deferredPromise\n      };\n      if (this.getStatus() === 'connecting') {\n        this._pendingRequestsQueue.set(requestId, reqItem);\n        return reqItem.deferredPromise;\n      }\n      this._sentRequestsQueue.set(requestId, reqItem);\n      try {\n        this._sendToSocket(reqItem.payload);\n      } catch (error) {\n        this._sentRequestsQueue.delete(requestId);\n        this._eventEmitter.emit('error', error);\n      }\n      return deferredPromise;\n    });\n  }\n  _onConnect() {\n    this._connectionStatus = 'connected';\n    this._reconnectAttempts = 0;\n    super._onConnect();\n    this._sendPendingRequests();\n  }\n  _sendPendingRequests() {\n    for (const [id, value] of this._pendingRequestsQueue.entries()) {\n      this._sendToSocket(value.payload);\n      this._pendingRequestsQueue.delete(id);\n      this._sentRequestsQueue.set(id, value);\n    }\n  }\n  _onMessage(event) {\n    const responses = this._parseResponses(event);\n    if ((0, validation_js_1.isNullish)(responses) || responses.length === 0) {\n      return;\n    }\n    for (const response of responses) {\n      if (jsonRpc.isResponseWithNotification(response) && response.method.endsWith('_subscription')) {\n        this._eventEmitter.emit('message', response);\n        return;\n      }\n      const requestId = jsonRpc.isBatchResponse(response) ? response[0].id : response.id;\n      const requestItem = this._sentRequestsQueue.get(requestId);\n      if (!requestItem) {\n        return;\n      }\n      if (jsonRpc.isBatchResponse(response) || jsonRpc.isResponseWithResult(response) || jsonRpc.isResponseWithError(response)) {\n        this._eventEmitter.emit('message', response);\n        requestItem.deferredPromise.resolve(response);\n      }\n      this._sentRequestsQueue.delete(requestId);\n    }\n  }\n  clearQueues(event) {\n    this._clearQueues(event);\n  }\n  _clearQueues(event) {\n    if (this._pendingRequestsQueue.size > 0) {\n      this._pendingRequestsQueue.forEach((request, key) => {\n        request.deferredPromise.reject(new web3_errors_1.ConnectionNotOpenError(event));\n        this._pendingRequestsQueue.delete(key);\n      });\n    }\n    if (this._sentRequestsQueue.size > 0) {\n      this._sentRequestsQueue.forEach((request, key) => {\n        request.deferredPromise.reject(new web3_errors_1.ConnectionNotOpenError(event));\n        this._sentRequestsQueue.delete(key);\n      });\n    }\n    this._removeSocketListeners();\n  }\n}\nexports.SocketProvider = SocketProvider;","map":{"version":3,"names":["web3_errors_1","require","web3_eip1193_provider_js_1","chunk_response_parser_js_1","validation_js_1","web3_deferred_promise_js_1","jsonRpc","__importStar","DEFAULT_RECONNECTION_OPTIONS","autoReconnect","delay","maxAttempts","NORMAL_CLOSE_CODE","SocketProvider","Eip1193Provider","constructor","socketPath","socketOptions","reconnectOptions","_connectionStatus","_onMessageHandler","_onMessage","bind","_onOpenHandler","_onConnect","_onCloseHandler","_onCloseEvent","_onErrorHandler","_onError","_validateProviderPath","InvalidClientError","_socketPath","_socketOptions","_reconnectOptions","Object","assign","_pendingRequestsQueue","Map","_sentRequestsQueue","_init","connect","chunkResponseParser","ChunkResponseParser","_eventEmitter","onError","_clearQueues","isReconnecting","SocketConnection","_socketConnection","_reconnectAttempts","_openSocketConnection","_addSocketListeners","e","message","ConnectionError","setImmediate","_reconnect","path","getPendingRequestQueueSize","size","getSentRequestsQueueSize","supportsSubscriptions","on","type","listener","once","removeListener","_onDisconnect","code","data","disconnect","disconnectCode","_removeSocketListeners","getStatus","_closeSocketConnection","safeDisconnect","forceDisconnect","ms","retryAttempt","checkQueue","__awaiter","Promise","resolve","interval","setInterval","clearQueues","clearInterval","removeAllListeners","event","emit","reset","clear","forEach","request","key","deferredPromise","reject","PendingRequestsOnReconnectingError","delete","setTimeout","MaxAttemptsReachedOnReconnectingError","isNullish","Error","requestId","isBatchRequest","id","Web3WSProviderError","has","RequestAlreadySentError","Web3DeferredPromise","catch","error","reqItem","payload","set","_sendToSocket","_sendPendingRequests","value","entries","responses","_parseResponses","length","response","isResponseWithNotification","method","endsWith","isBatchResponse","requestItem","get","isResponseWithResult","isResponseWithError","ConnectionNotOpenError","exports"],"sources":["../../src/socket_provider.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}