{"ast":null,"code":"\"use strict\";\n\nrequire(\"core-js/modules/es.typed-array.to-reversed.js\");\nrequire(\"core-js/modules/es.typed-array.to-sorted.js\");\nrequire(\"core-js/modules/es.typed-array.with.js\");\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.TransactionFactory = void 0;\nconst utils_js_1 = require(\"../common/utils.js\");\nconst eip1559Transaction_js_1 = require(\"./eip1559Transaction.js\");\nconst eip2930Transaction_js_1 = require(\"./eip2930Transaction.js\");\nconst legacyTransaction_js_1 = require(\"./legacyTransaction.js\");\nconst extraTxTypes = new Map();\n// eslint-disable-next-line @typescript-eslint/no-extraneous-class\nclass TransactionFactory {\n  // It is not possible to instantiate a TransactionFactory object.\n  // eslint-disable-next-line @typescript-eslint/no-empty-function, no-useless-constructor\n  constructor() {}\n  static typeToInt(txType) {\n    return Number((0, utils_js_1.uint8ArrayToBigInt)((0, utils_js_1.toUint8Array)(txType)));\n  }\n  static registerTransactionType(type, txClass) {\n    const txType = TransactionFactory.typeToInt(type);\n    extraTxTypes.set(txType, txClass);\n  }\n  /**\n   * Create a transaction from a `txData` object\n   *\n   * @param txData - The transaction data. The `type` field will determine which transaction type is returned (if undefined, creates a legacy transaction)\n   * @param txOptions - Options to pass on to the constructor of the transaction\n   */\n  static fromTxData(txData, txOptions = {}) {\n    if (!('type' in txData) || txData.type === undefined) {\n      // Assume legacy transaction\n      return legacyTransaction_js_1.Transaction.fromTxData(txData, txOptions);\n    }\n    const txType = TransactionFactory.typeToInt(txData.type);\n    if (txType === 0) {\n      return legacyTransaction_js_1.Transaction.fromTxData(txData, txOptions);\n    }\n    if (txType === 1) {\n      // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n      return eip2930Transaction_js_1.AccessListEIP2930Transaction.fromTxData(\n      // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n      txData, txOptions);\n    }\n    if (txType === 2) {\n      return eip1559Transaction_js_1.FeeMarketEIP1559Transaction.fromTxData(\n      // eslint-disable-next-line @typescript-eslint/consistent-type-assertions\n      txData, txOptions);\n    }\n    const ExtraTransaction = extraTxTypes.get(txType);\n    if (ExtraTransaction === null || ExtraTransaction === void 0 ? void 0 : ExtraTransaction.fromTxData) {\n      return ExtraTransaction.fromTxData(txData, txOptions);\n    }\n    throw new Error(`Tx instantiation with type ${txType} not supported`);\n  }\n  /**\n   * This method tries to decode serialized data.\n   *\n   * @param data - The data Uint8Array\n   * @param txOptions - The transaction options\n   */\n  static fromSerializedData(data, txOptions = {}) {\n    if (data[0] <= 0x7f) {\n      // Determine the type.\n      switch (data[0]) {\n        case 1:\n          return eip2930Transaction_js_1.AccessListEIP2930Transaction.fromSerializedTx(data, txOptions);\n        case 2:\n          return eip1559Transaction_js_1.FeeMarketEIP1559Transaction.fromSerializedTx(data, txOptions);\n        default:\n          {\n            const ExtraTransaction = extraTxTypes.get(Number(data[0]));\n            if (ExtraTransaction === null || ExtraTransaction === void 0 ? void 0 : ExtraTransaction.fromSerializedTx) {\n              return ExtraTransaction.fromSerializedTx(data, txOptions);\n            }\n            throw new Error(`TypedTransaction with ID ${data[0]} unknown`);\n          }\n      }\n    } else {\n      return legacyTransaction_js_1.Transaction.fromSerializedTx(data, txOptions);\n    }\n  }\n  /**\n   * When decoding a BlockBody, in the transactions field, a field is either:\n   * A Uint8Array (a TypedTransaction - encoded as TransactionType || rlp(TransactionPayload))\n   * A Uint8Array[] (Legacy Transaction)\n   * This method returns the right transaction.\n   *\n   * @param data - A Uint8Array or Uint8Array[]\n   * @param txOptions - The transaction options\n   */\n  static fromBlockBodyData(data, txOptions = {}) {\n    if (data instanceof Uint8Array) {\n      return this.fromSerializedData(data, txOptions);\n    }\n    if (Array.isArray(data)) {\n      // It is a legacy transaction\n      return legacyTransaction_js_1.Transaction.fromValuesArray(data, txOptions);\n    }\n    throw new Error('Cannot decode transaction: unknown type input');\n  }\n}\nexports.TransactionFactory = TransactionFactory;","map":{"version":3,"names":["utils_js_1","require","eip1559Transaction_js_1","eip2930Transaction_js_1","legacyTransaction_js_1","extraTxTypes","Map","TransactionFactory","constructor","typeToInt","txType","Number","uint8ArrayToBigInt","toUint8Array","registerTransactionType","type","txClass","set","fromTxData","txData","txOptions","undefined","Transaction","AccessListEIP2930Transaction","FeeMarketEIP1559Transaction","ExtraTransaction","get","Error","fromSerializedData","data","fromSerializedTx","fromBlockBodyData","Uint8Array","Array","isArray","fromValuesArray","exports"],"sources":["../../../src/tx/transactionFactory.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}