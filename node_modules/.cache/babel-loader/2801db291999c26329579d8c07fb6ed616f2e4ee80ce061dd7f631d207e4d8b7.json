{"ast":null,"code":"\"use strict\";\n\n/*\nThis file is part of web3.js.\n\nweb3.js is free software: you can redistribute it and/or modify\nit under the terms of the GNU Lesser General Public License as published by\nthe Free Software Foundation, either version 3 of the License, or\n(at your option) any later version.\n\nweb3.js is distributed in the hope that it will be useful,\nbut WITHOUT ANY WARRANTY; without even the implied warranty of\nMERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the\nGNU Lesser General Public License for more details.\n\nYou should have received a copy of the GNU Lesser General Public License\nalong with web3.js.  If not, see <http://www.gnu.org/licenses/>.\n*/\nvar __awaiter = this && this.__awaiter || function (thisArg, _arguments, P, generator) {\n  function adopt(value) {\n    return value instanceof P ? value : new P(function (resolve) {\n      resolve(value);\n    });\n  }\n  return new (P || (P = Promise))(function (resolve, reject) {\n    function fulfilled(value) {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function rejected(value) {\n      try {\n        step(generator[\"throw\"](value));\n      } catch (e) {\n        reject(e);\n      }\n    }\n    function step(result) {\n      result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected);\n    }\n    step((generator = generator.apply(thisArg, _arguments || [])).next());\n  });\n};\nvar __importDefault = this && this.__importDefault || function (mod) {\n  return mod && mod.__esModule ? mod : {\n    \"default\": mod\n  };\n};\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.Web3RequestManager = exports.Web3RequestManagerEvent = void 0;\nconst web3_errors_1 = require(\"web3-errors\");\nconst web3_providers_http_1 = __importDefault(require(\"web3-providers-http\"));\nconst web3_providers_ws_1 = __importDefault(require(\"web3-providers-ws\"));\nconst web3_utils_1 = require(\"web3-utils\");\nconst utils_js_1 = require(\"./utils.js\");\nconst web3_event_emitter_js_1 = require(\"./web3_event_emitter.js\");\nvar Web3RequestManagerEvent;\n(function (Web3RequestManagerEvent) {\n  Web3RequestManagerEvent[\"PROVIDER_CHANGED\"] = \"PROVIDER_CHANGED\";\n  Web3RequestManagerEvent[\"BEFORE_PROVIDER_CHANGE\"] = \"BEFORE_PROVIDER_CHANGE\";\n})(Web3RequestManagerEvent = exports.Web3RequestManagerEvent || (exports.Web3RequestManagerEvent = {}));\nconst availableProviders = {\n  HttpProvider: web3_providers_http_1.default,\n  WebsocketProvider: web3_providers_ws_1.default\n};\nclass Web3RequestManager extends web3_event_emitter_js_1.Web3EventEmitter {\n  constructor(provider, useRpcCallSpecification) {\n    super();\n    if (!(0, web3_utils_1.isNullish)(provider)) {\n      this.setProvider(provider);\n    }\n    this.useRpcCallSpecification = useRpcCallSpecification;\n  }\n  /**\n   * Will return all available providers\n   */\n  static get providers() {\n    return availableProviders;\n  }\n  /**\n   * Will return the current provider.\n   *\n   * @returns Returns the current provider\n   */\n  get provider() {\n    return this._provider;\n  }\n  /**\n   * Will return all available providers\n   */\n  // eslint-disable-next-line class-methods-use-this\n  get providers() {\n    return availableProviders;\n  }\n  /**\n   * Use to set provider. Provider can be a provider instance or a string.\n   *\n   * @param provider - The provider to set\n   */\n  setProvider(provider) {\n    let newProvider;\n    // autodetect provider\n    if (provider && typeof provider === 'string' && this.providers) {\n      // HTTP\n      if (/^http(s)?:\\/\\//i.test(provider)) {\n        newProvider = new this.providers.HttpProvider(provider);\n        // WS\n      } else if (/^ws(s)?:\\/\\//i.test(provider)) {\n        newProvider = new this.providers.WebsocketProvider(provider);\n      } else {\n        throw new web3_errors_1.ProviderError(`Can't autodetect provider for \"${provider}\"`);\n      }\n    } else if ((0, web3_utils_1.isNullish)(provider)) {\n      // In case want to unset the provider\n      newProvider = undefined;\n    } else {\n      newProvider = provider;\n    }\n    this.emit(Web3RequestManagerEvent.BEFORE_PROVIDER_CHANGE, this._provider);\n    this._provider = newProvider;\n    this.emit(Web3RequestManagerEvent.PROVIDER_CHANGED, this._provider);\n    return true;\n  }\n  /**\n   *\n   * Will execute a request\n   *\n   * @param request - {@link Web3APIRequest} The request to send\n   *\n   * @returns The response of the request {@link ResponseType}. If there is error\n   * in the response, will throw an error\n   */\n  send(request) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const response = yield this._sendRequest(request);\n      if (web3_utils_1.jsonRpc.isResponseWithResult(response)) {\n        return response.result;\n      }\n      throw new web3_errors_1.ResponseError(response);\n    });\n  }\n  /**\n   * Same as send, but, will execute a batch of requests\n   *\n   * @param request {@link JsonRpcBatchRequest} The batch request to send\n   */\n  sendBatch(request) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const response = yield this._sendRequest(request);\n      return response;\n    });\n  }\n  _sendRequest(request) {\n    return __awaiter(this, void 0, void 0, function* () {\n      const {\n        provider\n      } = this;\n      if ((0, web3_utils_1.isNullish)(provider)) {\n        throw new web3_errors_1.ProviderError('Provider not available. Use `.setProvider` or `.provider=` to initialize the provider.');\n      }\n      const payload = web3_utils_1.jsonRpc.isBatchRequest(request) ? web3_utils_1.jsonRpc.toBatchPayload(request) : web3_utils_1.jsonRpc.toPayload(request);\n      if ((0, utils_js_1.isWeb3Provider)(provider)) {\n        let response;\n        try {\n          response = yield provider.request(payload);\n        } catch (error) {\n          // Check if the provider throw an error instead of reject with error\n          response = error;\n        }\n        return this._processJsonRpcResponse(payload, response, {\n          legacy: false,\n          error: false\n        });\n      }\n      if ((0, utils_js_1.isEIP1193Provider)(provider)) {\n        return provider.request(payload).then(res => this._processJsonRpcResponse(payload, res, {\n          legacy: true,\n          error: false\n        })).catch(error => this._processJsonRpcResponse(payload, error, {\n          legacy: true,\n          error: true\n        }));\n      }\n      // TODO: This could be deprecated and removed.\n      if ((0, utils_js_1.isLegacyRequestProvider)(provider)) {\n        return new Promise((resolve, reject) => {\n          const rejectWithError = err => reject(this._processJsonRpcResponse(payload, err, {\n            legacy: true,\n            error: true\n          }));\n          const resolveWithResponse = response => resolve(this._processJsonRpcResponse(payload, response, {\n            legacy: true,\n            error: false\n          }));\n          const result = provider.request(payload,\n          // a callback that is expected to be called after getting the response:\n          (err, response) => {\n            if (err) {\n              return rejectWithError(err);\n            }\n            return resolveWithResponse(response);\n          });\n          // Some providers, that follow a previous drafted version of EIP1193, has a `request` function\n          //\tthat is not defined as `async`, but it returns a promise.\n          // Such providers would not be picked with if(isEIP1193Provider(provider)) above\n          //\tbecause the `request` function was not defined with `async` and so the function definition is not `AsyncFunction`.\n          // Like this provider: https://github.dev/NomicFoundation/hardhat/blob/62bea2600785595ba36f2105564076cf5cdf0fd8/packages/hardhat-core/src/internal/core/providers/backwards-compatibility.ts#L19\n          // So check if the returned result is a Promise, and resolve with it accordingly.\n          // Note: in this case we expect the callback provided above to never be called.\n          if ((0, web3_utils_1.isPromise)(result)) {\n            const responsePromise = result;\n            responsePromise.then(resolveWithResponse).catch(rejectWithError);\n          }\n        });\n      }\n      // TODO: This could be deprecated and removed.\n      if ((0, utils_js_1.isLegacySendProvider)(provider)) {\n        return new Promise((resolve, reject) => {\n          provider.send(payload, (err, response) => {\n            if (err) {\n              return reject(this._processJsonRpcResponse(payload, err, {\n                legacy: true,\n                error: true\n              }));\n            }\n            if ((0, web3_utils_1.isNullish)(response)) {\n              throw new web3_errors_1.ResponseError('', 'Got a \"nullish\" response from provider.');\n            }\n            return resolve(this._processJsonRpcResponse(payload, response, {\n              legacy: true,\n              error: false\n            }));\n          });\n        });\n      }\n      // TODO: This could be deprecated and removed.\n      if ((0, utils_js_1.isLegacySendAsyncProvider)(provider)) {\n        return provider.sendAsync(payload).then(response => this._processJsonRpcResponse(payload, response, {\n          legacy: true,\n          error: false\n        })).catch(error => this._processJsonRpcResponse(payload, error, {\n          legacy: true,\n          error: true\n        }));\n      }\n      throw new web3_errors_1.ProviderError('Provider does not have a request or send method to use.');\n    });\n  }\n  // eslint-disable-next-line class-methods-use-this\n  _processJsonRpcResponse(payload, response, {\n    legacy,\n    error\n  }) {\n    if ((0, web3_utils_1.isNullish)(response)) {\n      return this._buildResponse(payload,\n      // Some providers uses \"null\" as valid empty response\n      // eslint-disable-next-line no-null/no-null\n      null, error);\n    }\n    // This is the majority of the cases so check these first\n    // A valid JSON-RPC response with error object\n    if (web3_utils_1.jsonRpc.isResponseWithError(response)) {\n      // check if its an rpc error\n      if (this.useRpcCallSpecification && (0, web3_utils_1.isResponseRpcError)(response)) {\n        const rpcErrorResponse = response;\n        // check if rpc error flag is on and response error code match an EIP-1474 or a standard rpc error code\n        if (web3_errors_1.rpcErrorsMap.get(rpcErrorResponse.error.code)) {\n          // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n          const Err = web3_errors_1.rpcErrorsMap.get(rpcErrorResponse.error.code).error;\n          throw new Err(rpcErrorResponse);\n        } else {\n          throw new web3_errors_1.RpcError(rpcErrorResponse);\n        }\n      } else if (!Web3RequestManager._isReverted(response)) {\n        throw new web3_errors_1.InvalidResponseError(response, payload);\n      }\n    }\n    // This is the majority of the cases so check these first\n    // A valid JSON-RPC response with result object\n    if (web3_utils_1.jsonRpc.isResponseWithResult(response)) {\n      return response;\n    }\n    if (response instanceof Error) {\n      Web3RequestManager._isReverted(response);\n      throw response;\n    }\n    if (!legacy && web3_utils_1.jsonRpc.isBatchRequest(payload) && web3_utils_1.jsonRpc.isBatchResponse(response)) {\n      return response;\n    }\n    if (legacy && !error && web3_utils_1.jsonRpc.isBatchRequest(payload)) {\n      return response;\n    }\n    if (legacy && error && web3_utils_1.jsonRpc.isBatchRequest(payload)) {\n      // In case of error batch response we don't want to throw Invalid response\n      throw response;\n    }\n    if (legacy && !web3_utils_1.jsonRpc.isResponseWithError(response) && !web3_utils_1.jsonRpc.isResponseWithResult(response)) {\n      return this._buildResponse(payload, response, error);\n    }\n    if (web3_utils_1.jsonRpc.isBatchRequest(payload) && !Array.isArray(response)) {\n      throw new web3_errors_1.ResponseError(response, 'Got normal response for a batch request.');\n    }\n    if (!web3_utils_1.jsonRpc.isBatchRequest(payload) && Array.isArray(response)) {\n      throw new web3_errors_1.ResponseError(response, 'Got batch response for a normal request.');\n    }\n    if ((web3_utils_1.jsonRpc.isResponseWithError(response) || web3_utils_1.jsonRpc.isResponseWithResult(response)) && !web3_utils_1.jsonRpc.isBatchRequest(payload)) {\n      if (response.id && payload.id !== response.id) {\n        throw new web3_errors_1.InvalidResponseError(response);\n      }\n    }\n    throw new web3_errors_1.ResponseError(response, 'Invalid response');\n  }\n  static _isReverted(response) {\n    let error;\n    if (web3_utils_1.jsonRpc.isResponseWithError(response)) {\n      error = response.error;\n    } else if (response instanceof Error) {\n      error = response;\n    }\n    // This message means that there was an error while executing the code of the smart contract\n    // However, more processing will happen at a higher level to decode the error data,\n    //\taccording to the Error ABI, if it was available as of EIP-838.\n    if (error === null || error === void 0 ? void 0 : error.message.includes('revert')) throw new web3_errors_1.ContractExecutionError(error);\n    return false;\n  }\n  // Need to use same types as _processJsonRpcResponse so have to declare as instance method\n  // eslint-disable-next-line class-methods-use-this\n  _buildResponse(payload, response, error) {\n    const res = {\n      jsonrpc: '2.0',\n      // eslint-disable-next-line no-nested-ternary\n      id: web3_utils_1.jsonRpc.isBatchRequest(payload) ? payload[0].id : 'id' in payload ? payload.id :\n      // Have to use the null here explicitly\n      // eslint-disable-next-line no-null/no-null\n      null\n    };\n    if (error) {\n      return Object.assign(Object.assign({}, res), {\n        error: response\n      });\n    }\n    return Object.assign(Object.assign({}, res), {\n      result: response\n    });\n  }\n}\nexports.Web3RequestManager = Web3RequestManager;","map":{"version":3,"names":["web3_errors_1","require","web3_providers_http_1","__importDefault","web3_providers_ws_1","web3_utils_1","utils_js_1","web3_event_emitter_js_1","Web3RequestManagerEvent","exports","availableProviders","HttpProvider","default","WebsocketProvider","Web3RequestManager","Web3EventEmitter","constructor","provider","useRpcCallSpecification","isNullish","setProvider","providers","_provider","newProvider","test","ProviderError","undefined","emit","BEFORE_PROVIDER_CHANGE","PROVIDER_CHANGED","send","request","response","_sendRequest","jsonRpc","isResponseWithResult","result","ResponseError","sendBatch","payload","isBatchRequest","toBatchPayload","toPayload","isWeb3Provider","error","_processJsonRpcResponse","legacy","isEIP1193Provider","then","res","catch","isLegacyRequestProvider","Promise","resolve","reject","rejectWithError","err","resolveWithResponse","isPromise","responsePromise","isLegacySendProvider","isLegacySendAsyncProvider","sendAsync","_buildResponse","isResponseWithError","isResponseRpcError","rpcErrorResponse","rpcErrorsMap","get","code","Err","RpcError","_isReverted","InvalidResponseError","Error","isBatchResponse","Array","isArray","id","message","includes","ContractExecutionError","jsonrpc","Object","assign"],"sources":["../../src/web3_request_manager.ts"],"sourcesContent":[null],"mappings":"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"},"metadata":{},"sourceType":"script","externalDependencies":[]}